<?xml version="1.0" encoding="utf-8"?>
<search>
  <entry>
    <title>Add Databases to an Availability Group</title>
    <url>/2022/06/08/Add%20Database%20to%20an%20Availability%20Group/</url>
    <content><![CDATA[<h1 id="add-databases-to-an-availability-group">Add Databases to an
Availability Group</h1>
<p>In the primary replica, restore the database.</p>
<figure>
<img
src="/2022/06/08/Add%20Database%20to%20an%20Availability%20Group/image-20220608094437985.png"
alt="image-20220608094437985" />
<figcaption aria-hidden="true">image-20220608094437985</figcaption>
</figure>
<figure>
<img
src="/2022/06/08/Add%20Database%20to%20an%20Availability%20Group/image-20220608095913496.png"
alt="image-20220608095913496" />
<figcaption aria-hidden="true">image-20220608095913496</figcaption>
</figure>
<p>Change the <code>Recovery Model</code> to <strong>Full</strong>.</p>
<figure>
<img
src="/2022/06/08/Add%20Database%20to%20an%20Availability%20Group/image-20220608100229708.png"
alt="image-20220608100229708" />
<figcaption aria-hidden="true">image-20220608100229708</figcaption>
</figure>
<p>Run the script to make full backups and tlog backups.</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><code class="hljs sql"><span class="hljs-comment">--Full Backups</span><br>BACKUP DATABASE [WideWorldImporters] <span class="hljs-keyword">TO</span>  DISK <span class="hljs-operator">=</span> N<span class="hljs-string">&#x27;C:\Program Files\Microsoft SQL Server\MSSQL15.SQL1\MSSQL\Backup\WideWorldImporters_FullBackup_20220608.bak&#x27;</span> <br><span class="hljs-keyword">WITH</span> NOFORMAT, NOINIT,  <br>NAME <span class="hljs-operator">=</span> N<span class="hljs-string">&#x27;WideWorldImporters-Full Database Backup&#x27;</span>, <br><span class="hljs-keyword">SKIP</span>, NOREWIND, NOUNLOAD, COMPRESSION,  STATS <span class="hljs-operator">=</span> <span class="hljs-number">10</span>, CHECKSUM<br>GO<br><br><span class="hljs-comment">--Tlog Backups</span><br>BACKUP LOG [WideWorldImporters] <span class="hljs-keyword">TO</span>  DISK <span class="hljs-operator">=</span> N<span class="hljs-string">&#x27;C:\Program Files\Microsoft SQL Server\MSSQL15.SQL1\MSSQL\Backup\WideWorldImporters_TlogBackup_20220608.trn&#x27;</span> <br><span class="hljs-keyword">WITH</span> NOFORMAT, NOINIT,  <br>NAME <span class="hljs-operator">=</span> N<span class="hljs-string">&#x27;WideWorldImporters-Full Database Backup&#x27;</span>, <br><span class="hljs-keyword">SKIP</span>, NOREWIND, NOUNLOAD, COMPRESSION,  STATS <span class="hljs-operator">=</span> <span class="hljs-number">10</span>, CHECKSUM<br>GO<br></code></pre></td></tr></table></figure>
<p>In the <strong>Properties</strong> page of the AG, add the name of
the database, then click on <code>OK</code>, if there is no warning,
then we successfully added an additional database to the AG.</p>
<figure>
<img
src="/2022/06/08/Add%20Database%20to%20an%20Availability%20Group/image-20220608100051919.png"
alt="image-20220608100051919" />
<figcaption aria-hidden="true">image-20220608100051919</figcaption>
</figure>
<figure>
<img
src="/2022/06/08/Add%20Database%20to%20an%20Availability%20Group/image-20220608100634388.png"
alt="image-20220608100634388" />
<figcaption aria-hidden="true">image-20220608100634388</figcaption>
</figure>
]]></content>
      <tags>
        <tag>SQL Server</tag>
      </tags>
  </entry>
  <entry>
    <title>Build a Failover Cluster on VMAS</title>
    <url>/2022/06/07/Build%20a%20failover%20cluster%20on%20VMAS/</url>
    <content><![CDATA[<h1 id="build-a-failover-cluster-on-vmas">Build a failover cluster on
VMAS</h1>
<h2 id="preparation">Preparation</h2>
<h3 id="configure-domain-controller">Configure Domain Controller</h3>
<p>In the <strong>Server Manager</strong> of the server that you want to
use as a Domain Controller, click on <strong>Add roles and
features</strong>.</p>
<figure>
<img
src="/2022/06/07/Build%20a%20failover%20cluster%20on%20VMAS/image-20220602103151680.png"
alt="image-20220602103151680" />
<figcaption aria-hidden="true">image-20220602103151680</figcaption>
</figure>
<p>Check <code>Active Directory Domain Services</code> and
<code>DNS Server</code> tabs and continue the installation.</p>
<figure>
<img
src="/2022/06/07/Build%20a%20failover%20cluster%20on%20VMAS/image-20220602102333211.png"
alt="image-20220602102333211" />
<figcaption aria-hidden="true">image-20220602102333211</figcaption>
</figure>
<h3 id="configure-domain-settings">Configure Domain Settings</h3>
<p>For the node servers, <strong>Control Panel --&gt; System and
Security --&gt; System --&gt; Change settings --&gt; Change</strong>,
set the <code>Domain</code> as you created. You may need to reboot the
machine to make effects.</p>
<figure>
<img
src="/2022/06/07/Build%20a%20failover%20cluster%20on%20VMAS/image-20220607180631031.png"
alt="image-20220607180631031" />
<figcaption aria-hidden="true">image-20220607180631031</figcaption>
</figure>
<h3 id="configure-dns-settings">Configure DNS Settings</h3>
<p>For the node servers, change their DNS settings to the same as the
DC, <strong>Control Panel --&gt; Network and Internet --&gt; Network
Connections --&gt; Properties --&gt; Internet Protocol Version 4
(TCP/IPv4)</strong>.</p>
<figure>
<img
src="/2022/06/07/Build%20a%20failover%20cluster%20on%20VMAS/image-20220607181311498.png"
alt="image-20220607181311498" />
<figcaption aria-hidden="true">image-20220607181311498</figcaption>
</figure>
<h2 id="add-the-failover-clustering-feature-to-nodes">Add the Failover
Clustering Feature to Nodes</h2>
<p>This should be done for all the servers that you want to join your
WSFC.</p>
<p>In the <strong>Server Manager</strong> of node servers, click
<strong>Add roles and features</strong>.</p>
<figure>
<img
src="/2022/06/07/Build%20a%20failover%20cluster%20on%20VMAS/image-20220602103139638.png"
alt="image-20220602103139638" />
<figcaption aria-hidden="true">image-20220602103139638</figcaption>
</figure>
<figure>
<img
src="/2022/06/07/Build%20a%20failover%20cluster%20on%20VMAS/image-20220602102912334.png"
alt="image-20220602102912334" />
<figcaption aria-hidden="true">image-20220602102912334</figcaption>
</figure>
<p>Check <code>Failover Clustering</code>.</p>
<figure>
<img
src="/2022/06/07/Build%20a%20failover%20cluster%20on%20VMAS/image-20220602104348148.png"
alt="image-20220602104348148" />
<figcaption aria-hidden="true">image-20220602104348148</figcaption>
</figure>
<figure>
<img
src="/2022/06/07/Build%20a%20failover%20cluster%20on%20VMAS/image-20220602103048935.png"
alt="image-20220602103048935" />
<figcaption aria-hidden="true">image-20220602103048935</figcaption>
</figure>
<h2 id="running-the-failover-cluster-validation-wizard">Running the
Failover Cluster Validation Wizard</h2>
<p>Before creating the cluster, it's better to validate first. This step
can be done on any of your node servers.</p>
<p><strong>Server Manager --&gt; Tools --&gt; Failover Cluster
Manager</strong></p>
<figure>
<img
src="/2022/06/07/Build%20a%20failover%20cluster%20on%20VMAS/image-20220602105158375.png"
alt="image-20220602105158375" />
<figcaption aria-hidden="true">image-20220602105158375</figcaption>
</figure>
<p>Select <strong>Validate Configuration</strong></p>
<figure>
<img
src="/2022/06/07/Build%20a%20failover%20cluster%20on%20VMAS/image-20220602105248004.png"
alt="image-20220602105248004" />
<figcaption aria-hidden="true">image-20220602105248004</figcaption>
</figure>
<p>In the <code>Select Servers or a Cluster</code> section, you may find
the <code>Selected Servers</code> list is empty. Click
<code>Browse</code> and search servers using their names.</p>
<figure>
<img
src="/2022/06/07/Build%20a%20failover%20cluster%20on%20VMAS/image-20220602110339994.png"
alt="image-20220602110339994" />
<figcaption aria-hidden="true">image-20220602110339994</figcaption>
</figure>
<figure>
<img
src="/2022/06/07/Build%20a%20failover%20cluster%20on%20VMAS/image-20220602110303490.png"
alt="image-20220602110303490" />
<figcaption aria-hidden="true">image-20220602110303490</figcaption>
</figure>
<p>Run the test and see the test result.</p>
<figure>
<img
src="/2022/06/07/Build%20a%20failover%20cluster%20on%20VMAS/image-20220602110507810.png"
alt="image-20220602110507810" />
<figcaption aria-hidden="true">image-20220602110507810</figcaption>
</figure>
<figure>
<img
src="/2022/06/07/Build%20a%20failover%20cluster%20on%20VMAS/image-20220602110705518.png"
alt="image-20220602110705518" />
<figcaption aria-hidden="true">image-20220602110705518</figcaption>
</figure>
<p>If all tests are successful, check the
<code>Create the cluster now using the validated nodes</code> to start
creating clusters.</p>
<figure>
<img
src="/2022/06/07/Build%20a%20failover%20cluster%20on%20VMAS/image-20220607174119603.png"
alt="image-20220607174119603" />
<figcaption aria-hidden="true">image-20220607174119603</figcaption>
</figure>
<h2 id="create-wsfc">Create WSFC</h2>
<p>If you checked the
<code>Create the cluster now using the validated nodes</code> box,
simply continue installing would successfully create a failover
cluster.</p>
<h3 id="configure-static-ip-address">Configure Static IP Address</h3>
<p>Double click on the cluster you've created, you will see the
following prompt, and check the <code>Static IP Address</code>.</p>
<figure>
<img
src="/2022/06/07/Build%20a%20failover%20cluster%20on%20VMAS/image-20220602121732074.png"
alt="image-20220602121732074" />
<figcaption aria-hidden="true">image-20220602121732074</figcaption>
</figure>
<h2 id="build-iscsi-virtual-disk">Build iSCSI Virtual Disk</h2>
<p>One DC as Disk Server.</p>
<p>Two node servers as clients.</p>
<h3 id="configure-disk-server">Configure Disk Server</h3>
<h4 id="install-iscsi-service">Install iSCSI service</h4>
<p>Again, in the <strong>Server Manager --&gt; Add Roles and
Features</strong>. Expand the <code>File and Storage Services</code> and
check boxes start with <code>iSCSI</code>.</p>
<figure>
<img
src="/2022/06/07/Build%20a%20failover%20cluster%20on%20VMAS/image-20220602123004600.png"
alt="image-20220602123004600" />
<figcaption aria-hidden="true">image-20220602123004600</figcaption>
</figure>
<figure>
<img
src="/2022/06/07/Build%20a%20failover%20cluster%20on%20VMAS/image-20220602123112170.png"
alt="image-20220602123112170" />
<figcaption aria-hidden="true">image-20220602123112170</figcaption>
</figure>
<h4 id="create-virtual-disk">Create virtual disk</h4>
<p>Click on <strong>TASKS</strong> and <strong>New iSCSI Virtual
Disk</strong>.</p>
<figure>
<img
src="/2022/06/07/Build%20a%20failover%20cluster%20on%20VMAS/image-20220602123606013.png"
alt="image-20220602123606013" />
<figcaption aria-hidden="true">image-20220602123606013</figcaption>
</figure>
<p>Either <code>Select by volume</code> or
<code>Type a custom path</code> works.</p>
<figure>
<img
src="/2022/06/07/Build%20a%20failover%20cluster%20on%20VMAS/image-20220602123754160.png"
alt="image-20220602123754160" />
<figcaption aria-hidden="true">image-20220602123754160</figcaption>
</figure>
<figure>
<img
src="/2022/06/07/Build%20a%20failover%20cluster%20on%20VMAS/image-20220602123850625.png"
alt="image-20220602123850625" />
<figcaption aria-hidden="true">image-20220602123850625</figcaption>
</figure>
<figure>
<img
src="/2022/06/07/Build%20a%20failover%20cluster%20on%20VMAS/image-20220602124038768.png"
alt="image-20220602124038768" />
<figcaption aria-hidden="true">image-20220602124038768</figcaption>
</figure>
<figure>
<img
src="/2022/06/07/Build%20a%20failover%20cluster%20on%20VMAS/image-20220602124119537.png"
alt="image-20220602124119537" />
<figcaption aria-hidden="true">image-20220602124119537</figcaption>
</figure>
<figure>
<img
src="/2022/06/07/Build%20a%20failover%20cluster%20on%20VMAS/image-20220602124204011.png"
alt="image-20220602124204011" />
<figcaption aria-hidden="true">image-20220602124204011</figcaption>
</figure>
<p>Here I choose to query clients, as we did before in the creating
clusters section.</p>
<figure>
<img
src="/2022/06/07/Build%20a%20failover%20cluster%20on%20VMAS/image-20220602124345269.png"
alt="image-20220602124345269" />
<figcaption aria-hidden="true">image-20220602124345269</figcaption>
</figure>
<p>Those are client servers that access the disk server.</p>
<figure>
<img
src="/2022/06/07/Build%20a%20failover%20cluster%20on%20VMAS/image-20220602125418777.png"
alt="image-20220602125418777" />
<figcaption aria-hidden="true">image-20220602125418777</figcaption>
</figure>
<figure>
<img
src="/2022/06/07/Build%20a%20failover%20cluster%20on%20VMAS/image-20220602125735307.png"
alt="image-20220602125735307" />
<figcaption aria-hidden="true">image-20220602125735307</figcaption>
</figure>
<figure>
<img
src="/2022/06/07/Build%20a%20failover%20cluster%20on%20VMAS/image-20220602130013751.png"
alt="image-20220602130013751" />
<figcaption aria-hidden="true">image-20220602130013751</figcaption>
</figure>
<h4 id="configuration">Configuration</h4>
<p><strong>Server Manager --&gt; File and Storage Services --&gt; iSCSI
--&gt; iSCSI</strong></p>
<p>We can add initiators here.</p>
<figure>
<img
src="/2022/06/07/Build%20a%20failover%20cluster%20on%20VMAS/image-20220602130314511.png"
alt="image-20220602130314511" />
<figcaption aria-hidden="true">image-20220602130314511</figcaption>
</figure>
<h3 id="configure-client-servers">Configure Client Servers</h3>
<p>For each client server, configure it as the following.</p>
<p>Double click to start the <code>iSCSI Initiator</code> service.</p>
<figure>
<img
src="/2022/06/07/Build%20a%20failover%20cluster%20on%20VMAS/image-20220602132228794.png"
alt="image-20220602132228794" />
<figcaption aria-hidden="true">image-20220602132228794</figcaption>
</figure>
<p>Since my initiator for the disk server is an IQN connection, I need
to input the IP address here. Note that we can find the IP address of
the disk server by typing <code>ipconfig</code> in the command line.</p>
<figure>
<img
src="/2022/06/07/Build%20a%20failover%20cluster%20on%20VMAS/image-20220602132943178.png"
alt="image-20220602132943178" />
<figcaption aria-hidden="true">image-20220602132943178</figcaption>
</figure>
<p>In the <code>Volumes and Devices</code>, click
<code>Auto Configure</code> to add the virtual disk to the volume
list.</p>
<figure>
<img
src="/2022/06/07/Build%20a%20failover%20cluster%20on%20VMAS/image-20220602135943801.png"
alt="image-20220602135943801" />
<figcaption aria-hidden="true">image-20220602135943801</figcaption>
</figure>
<p>Now, we can bring the virtual disk online.</p>
<figure>
<img
src="/2022/06/07/Build%20a%20failover%20cluster%20on%20VMAS/image-20220602133216522.png"
alt="image-20220602133216522" />
<figcaption aria-hidden="true">image-20220602133216522</figcaption>
</figure>
<p>In the <strong>Disk Management</strong>, we can check the status of
the virtual disk.</p>
<figure>
<img
src="/2022/06/07/Build%20a%20failover%20cluster%20on%20VMAS/image-20220602133526450.png"
alt="image-20220602133526450" />
<figcaption aria-hidden="true">image-20220602133526450</figcaption>
</figure>
<p>Note that for both clients and disk servers, we need to turn the
startup type of iSCSI service to <code>auto</code>.</p>
<figure>
<img
src="/2022/06/07/Build%20a%20failover%20cluster%20on%20VMAS/image-20220602133916305.png"
alt="image-20220602133916305" />
<figcaption aria-hidden="true">image-20220602133916305</figcaption>
</figure>
<h3 id="add-virtual-disk-to-cluster">Add Virtual Disk to Cluster</h3>
<p>Go to the Disk Management on any node server, initialize and create a
new volume for the virtual disk.</p>
<figure>
<img
src="/2022/06/07/Build%20a%20failover%20cluster%20on%20VMAS/image-20220602152433107.png"
alt="image-20220602152433107" />
<figcaption aria-hidden="true">image-20220602152433107</figcaption>
</figure>
<p>Then go to the <strong>Failover Cluster Manager</strong>, in the
<strong>Disk</strong> tab, <code>Add Disk</code>. Choose the virtual
disk created before. Then, in the active node server, we can find a new
volume in the file explorer. You can click
<code>Move Available Storage</code> to see whether the action
succeeded.</p>
<figure>
<img
src="/2022/06/07/Build%20a%20failover%20cluster%20on%20VMAS/image-20220602151901691.png"
alt="image-20220602151901691" />
<figcaption aria-hidden="true">image-20220602151901691</figcaption>
</figure>
<h2 id="configure-the-cluster-quorum-settings">Configure the Cluster
Quorum Settings</h2>
<p>On the disk of the DC server, create a Witness file folder and share
it. Make sure to give permissions to your WSFC server.</p>
<figure>
<img
src="/2022/06/07/Build%20a%20failover%20cluster%20on%20VMAS/image-20220606092732482.png"
alt="image-20220606092732482" />
<figcaption aria-hidden="true">image-20220606092732482</figcaption>
</figure>
<p>Right click on your cluster, <strong>More Actions --&gt; Configure
Cluster Quorum Settings</strong>. This can be done in any of your node
servers.</p>
<figure>
<img
src="/2022/06/07/Build%20a%20failover%20cluster%20on%20VMAS/image-20220606093158802.png"
alt="image-20220606093158802" />
<figcaption aria-hidden="true">image-20220606093158802</figcaption>
</figure>
<p>In the <code>Configure Cluster Quorum Wizard</code>,
<code>Advanced quorum configuration --&gt; All Nodes --&gt; Configure a file share witness --&gt; Select the path of your shared folder</code></p>
<figure>
<img
src="/2022/06/07/Build%20a%20failover%20cluster%20on%20VMAS/image-20220606093427113.png"
alt="image-20220606093427113" />
<figcaption aria-hidden="true">image-20220606093427113</figcaption>
</figure>
<figure>
<img
src="/2022/06/07/Build%20a%20failover%20cluster%20on%20VMAS/image-20220606093544405.png"
alt="image-20220606093544405" />
<figcaption aria-hidden="true">image-20220606093544405</figcaption>
</figure>
<figure>
<img
src="/2022/06/07/Build%20a%20failover%20cluster%20on%20VMAS/image-20220606093655628.png"
alt="image-20220606093655628" />
<figcaption aria-hidden="true">image-20220606093655628</figcaption>
</figure>
<figure>
<img
src="/2022/06/07/Build%20a%20failover%20cluster%20on%20VMAS/image-20220606093810393.png"
alt="image-20220606093810393" />
<figcaption aria-hidden="true">image-20220606093810393</figcaption>
</figure>
<figure>
<img
src="/2022/06/07/Build%20a%20failover%20cluster%20on%20VMAS/image-20220606093833067.png"
alt="image-20220606093833067" />
<figcaption aria-hidden="true">image-20220606093833067</figcaption>
</figure>
<h2
id="install-a-sql-server-2019-failover-clustered-instance-fci">Install a
SQL Server 2019 Failover Clustered Instance (FCI)</h2>
<p>Download the SQL Server 2019 installation media on the two node
servers.</p>
<figure>
<img
src="/2022/06/07/Build%20a%20failover%20cluster%20on%20VMAS/image-20220602164508936.png"
alt="image-20220602164508936" />
<figcaption aria-hidden="true">image-20220602164508936</figcaption>
</figure>
<h3 id="for-the-primary-node-server">For the primary node server</h3>
<p>Run the <strong>setup.exe</strong>,
<code>New SQL Server failover cluster installation</code> in the
<code>installation</code> tab.</p>
<figure>
<img
src="/2022/06/07/Build%20a%20failover%20cluster%20on%20VMAS/image-20220606094314046.png"
alt="image-20220606094314046" />
<figcaption aria-hidden="true">image-20220606094314046</figcaption>
</figure>
<p>It will go through server checks.</p>
<figure>
<img
src="/2022/06/07/Build%20a%20failover%20cluster%20on%20VMAS/image-20220602164925334.png"
alt="image-20220602164925334" />
<figcaption aria-hidden="true">image-20220602164925334</figcaption>
</figure>
<p>If you have successfully added the virtual disk to the cluster, your
virtual disks will be shown here.</p>
<figure>
<img
src="/2022/06/07/Build%20a%20failover%20cluster%20on%20VMAS/image-20220602165504291.png"
alt="image-20220602165504291" />
<figcaption aria-hidden="true">image-20220602165504291</figcaption>
</figure>
<p>Create an IP Address that is different from all IP addresses of your
servers and the cluster.</p>
<figure>
<img
src="/2022/06/07/Build%20a%20failover%20cluster%20on%20VMAS/image-20220602165656261.png"
alt="image-20220602165656261" />
<figcaption aria-hidden="true">image-20220602165656261</figcaption>
</figure>
<figure>
<img
src="/2022/06/07/Build%20a%20failover%20cluster%20on%20VMAS/image-20220602165816089.png"
alt="image-20220602165816089" />
<figcaption aria-hidden="true">image-20220602165816089</figcaption>
</figure>
<figure>
<img
src="/2022/06/07/Build%20a%20failover%20cluster%20on%20VMAS/image-20220602165914386.png"
alt="image-20220602165914386" />
<figcaption aria-hidden="true">image-20220602165914386</figcaption>
</figure>
<figure>
<img
src="/2022/06/07/Build%20a%20failover%20cluster%20on%20VMAS/image-20220602165926475.png"
alt="image-20220602165926475" />
<figcaption aria-hidden="true">image-20220602165926475</figcaption>
</figure>
<h3 id="for-the-secondary-node-server">For the secondary node
server</h3>
<p>Run the <strong>setup.exe</strong>,
<code>Add node to a SQL Server failover cluster</code> in the
<code>installation</code> tab.</p>
<figure>
<img
src="/2022/06/07/Build%20a%20failover%20cluster%20on%20VMAS/image-20220602174455520.png"
alt="image-20220602174455520" />
<figcaption aria-hidden="true">image-20220602174455520</figcaption>
</figure>
<p>Follow similar steps to add a node to the failover cluster.</p>
<figure>
<img
src="/2022/06/07/Build%20a%20failover%20cluster%20on%20VMAS/image-20220602174957642.png"
alt="image-20220602174957642" />
<figcaption aria-hidden="true">image-20220602174957642</figcaption>
</figure>
<figure>
<img
src="/2022/06/07/Build%20a%20failover%20cluster%20on%20VMAS/image-20220606102320690.png"
alt="image-20220606102320690" />
<figcaption aria-hidden="true">image-20220606102320690</figcaption>
</figure>
<h2 id="testing-failover">Testing Failover</h2>
<p>In the <strong>Failover Cluster Manager</strong>, find the cluster,
<strong>Simulate Failure</strong>.</p>
<figure>
<img
src="/2022/06/07/Build%20a%20failover%20cluster%20on%20VMAS/image-20220607174939143.png"
alt="image-20220607174939143" />
<figcaption aria-hidden="true">image-20220607174939143</figcaption>
</figure>
]]></content>
      <tags>
        <tag>SQL Server</tag>
      </tags>
  </entry>
  <entry>
    <title>Change Vote Weight of WSFC Node Servers</title>
    <url>/2022/06/06/Change%20Vote%20Weight%20of%20WSFC%20Node%20Servers/</url>
    <content><![CDATA[<h1 id="change-vote-weight-of-wsfc-node-servers">Change Vote Weight of
WSFC Node Servers</h1>
<p>Currently, my node servers have the voting values as the
following.</p>
<figure>
<img
src="/2022/06/06/Change%20Vote%20Weight%20of%20WSFC%20Node%20Servers/image-20220606171346007.png"
alt="image-20220606171346007" />
<figcaption aria-hidden="true">image-20220606171346007</figcaption>
</figure>
<p>In <strong>Windows PowerShell</strong>, we can view the node servers
by <code>get-clusternode</code>.</p>
<figure>
<img
src="/2022/06/06/Change%20Vote%20Weight%20of%20WSFC%20Node%20Servers/image-20220606171619268.png"
alt="image-20220606171619268" />
<figcaption aria-hidden="true">image-20220606171619268</figcaption>
</figure>
<p>Then, to change the vote weight,</p>
<figure class="highlight powershell"><table><tr><td class="code"><pre><code class="hljs powershell"><span class="hljs-comment"># (get-clusternode NODE_NAME).nodeweight = VALUE</span><br>(<span class="hljs-built_in">get-clusternode</span> tjxiem406VM).nodeweight = <span class="hljs-number">0</span><br></code></pre></td></tr></table></figure>
<figure>
<img
src="/2022/06/06/Change%20Vote%20Weight%20of%20WSFC%20Node%20Servers/image-20220606172036812.png"
alt="image-20220606172036812" />
<figcaption aria-hidden="true">image-20220606172036812</figcaption>
</figure>
]]></content>
      <tags>
        <tag>SQL Server</tag>
      </tags>
  </entry>
  <entry>
    <title>Freeze SQL service manually using WinDbg</title>
    <url>/2022/06/06/Freeze%20SQL%20service%20manually%20using%20WinDbg/</url>
    <content><![CDATA[<h1 id="freeze-sql-service-manually-using-windbg">Freeze SQL service
manually using WinDbg</h1>
<p>Currently, the SQL failover cluster works normally.</p>
<figure>
<img
src="/2022/06/06/Freeze%20SQL%20service%20manually%20using%20WinDbg/image-20220606132830651.png"
alt="image-20220606132830651" />
<figcaption aria-hidden="true">image-20220606132830651</figcaption>
</figure>
<p>In the SSMS (Microsoft SQL Server Management Studio), the following
query returns the process id and other information related to the SQL
server service.</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><code class="hljs sql"><span class="hljs-comment">-- Thread ID</span><br><span class="hljs-keyword">SELECT</span> kpid,<span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> sys.sysprocesses <span class="hljs-keyword">where</span> program_name  <span class="hljs-keyword">like</span> <span class="hljs-string">&#x27;Microsoft® Windows® Operating System%&#x27;</span><br><span class="hljs-comment">-- Prrocess ID</span><br><span class="hljs-keyword">SELECT</span> process_id,<span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> sys.dm_server_services <span class="hljs-keyword">WHERE</span> servicename <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;SQL Server (MSSQLSERVER)&#x27;</span><br></code></pre></td></tr></table></figure>
<p>Note that the thread ID here is the id for the system, we need to
convert the id before using it.</p>
<figure>
<img
src="/2022/06/06/Freeze%20SQL%20service%20manually%20using%20WinDbg/image-20220606164943627.png"
alt="image-20220606164943627" />
<figcaption aria-hidden="true">image-20220606164943627</figcaption>
</figure>
<p>In <strong>WinDbg</strong>, attach to the <code>sqlserver.exe</code>
process. As you can see, the process id is the same as the query result.
Note that make sure the WinDbg is running on the node server that is the
current host of the cluster, or you may not find the
<code>sqlserver.exe</code> in the list.</p>
<figure>
<img
src="/2022/06/06/Freeze%20SQL%20service%20manually%20using%20WinDbg/image-20220606165000885.png"
alt="image-20220606165000885" />
<figcaption aria-hidden="true">image-20220606165000885</figcaption>
</figure>
<p>Convert the thread ID into hexadecimal, then enter
<code>~~[HEX Thread ID]</code> to get the thread ID (debug ID) in the
debugger. Then we can freeze the SQL service by
<code>~Debug ID f</code>.</p>
<figure>
<img
src="/2022/06/06/Freeze%20SQL%20service%20manually%20using%20WinDbg/image-20220606165508820.png"
alt="image-20220606165508820" />
<figcaption aria-hidden="true">image-20220606165508820</figcaption>
</figure>
<p>Now, we observe that the SQL service is frozen.</p>
<figure>
<img
src="/2022/06/06/Freeze%20SQL%20service%20manually%20using%20WinDbg/image-20220606170306322.png"
alt="image-20220606170306322" />
<figcaption aria-hidden="true">image-20220606170306322</figcaption>
</figure>
<p>To resume the service, detach the process from the debugger. Then the
SQL server will be brought online.</p>
]]></content>
      <tags>
        <tag>SQL Server</tag>
        <tag>WinDbg</tag>
      </tags>
  </entry>
  <entry>
    <title>Install Always On 2019 For Failover Clusters</title>
    <url>/2022/06/08/Install%20AlwaysOn%202019%20For%20Failover%20Clusters/</url>
    <content><![CDATA[<h1 id="install-always-on-2019-for-failover-clusters">Install Always On
2019 For Failover Clusters</h1>
<h2 id="configure-sql-server">Configure SQL Server</h2>
<p>On each of the node servers (replica), turn on <strong>SQL Server
Configuration Manager</strong>, <strong>SQL Server Services --&gt; SQL
Server (MSSQLSERVER) --&gt; Properties --&gt; Always on Availability
Groups --&gt; Enable Always on Availability Groups</strong>.</p>
<figure>
<img
src="/2022/06/08/Install%20AlwaysOn%202019%20For%20Failover%20Clusters/image-20220607094155497.png"
alt="image-20220607094155497" />
<figcaption aria-hidden="true">image-20220607094155497</figcaption>
</figure>
<p>Then we install a stand-alone SQL service for the two node servers
(replica).</p>
<figure>
<img
src="/2022/06/08/Install%20AlwaysOn%202019%20For%20Failover%20Clusters/image-20220607113534697.png"
alt="image-20220607113534697" />
<figcaption aria-hidden="true">image-20220607113534697</figcaption>
</figure>
<figure>
<img
src="/2022/06/08/Install%20AlwaysOn%202019%20For%20Failover%20Clusters/image-20220607113818112.png"
alt="image-20220607113818112" />
<figcaption aria-hidden="true">image-20220607113818112</figcaption>
</figure>
<figure>
<img
src="/2022/06/08/Install%20AlwaysOn%202019%20For%20Failover%20Clusters/image-20220607114135531.png"
alt="image-20220607114135531" />
<figcaption aria-hidden="true">image-20220607114135531</figcaption>
</figure>
<figure>
<img
src="/2022/06/08/Install%20AlwaysOn%202019%20For%20Failover%20Clusters/image-20220607114435948.png"
alt="image-20220607114435948" />
<figcaption aria-hidden="true">image-20220607114435948</figcaption>
</figure>
<figure>
<img
src="/2022/06/08/Install%20AlwaysOn%202019%20For%20Failover%20Clusters/image-20220607114540380.png"
alt="image-20220607114540380" />
<figcaption aria-hidden="true">image-20220607114540380</figcaption>
</figure>
<figure>
<img
src="/2022/06/08/Install%20AlwaysOn%202019%20For%20Failover%20Clusters/image-20220607114626758.png"
alt="image-20220607114626758" />
<figcaption aria-hidden="true">image-20220607114626758</figcaption>
</figure>
<p>Also, we need to enable <strong>Always on Availability
Groups</strong> service as we did before for the two stand-alone SQL
services.</p>
<figure>
<img
src="/2022/06/08/Install%20AlwaysOn%202019%20For%20Failover%20Clusters/image-20220607132532145.png"
alt="image-20220607132532145" />
<figcaption aria-hidden="true">image-20220607132532145</figcaption>
</figure>
<p>Moreover, for the secondary replica, we need to make sure its local
SQL service can be connected to the primary replica. In the <strong>SQL
Server Configuration Manager</strong> of the secondary replica,
<strong>SQL Server Network Configuration --&gt; Protocols for SQL2
</strong>, enable <code>Named Pipes</code> and <code>TCP/IP</code>.</p>
<p>You need to restart the servers to make all the changes.</p>
<figure>
<img
src="/2022/06/08/Install%20AlwaysOn%202019%20For%20Failover%20Clusters/image-20220607151315019.png"
alt="image-20220607151315019" />
<figcaption aria-hidden="true">image-20220607151315019</figcaption>
</figure>
<h2 id="restore-and-backup-databases">Restore and Backup Databases</h2>
<p>If you have databases that need to be added to the AG, make sure that
they are in <strong>Full Recovery Mode</strong> and remove these
databases from any <strong>tlog backup maintenance</strong>. Here I need
to restore and back up <code>AdventureWorks2019</code> database.</p>
<p>Restore the database on the primary replica, SQL 1.</p>
<figure>
<img
src="/2022/06/08/Install%20AlwaysOn%202019%20For%20Failover%20Clusters/image-20220607151437088.png"
alt="image-20220607151437088" />
<figcaption aria-hidden="true">image-20220607151437088</figcaption>
</figure>
<p>Change the <code>Recovery Model</code> to <code>Full</code>.</p>
<figure>
<img
src="/2022/06/08/Install%20AlwaysOn%202019%20For%20Failover%20Clusters/image-20220607103723163.png"
alt="image-20220607103723163" />
<figcaption aria-hidden="true">image-20220607103723163</figcaption>
</figure>
<p>Take Full and tlog backups of all databases before adding them to
AG.</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><code class="hljs sql"><span class="hljs-comment">--Full Backups</span><br>BACKUP DATABASE [AdventureWorks2019] <span class="hljs-keyword">TO</span>  DISK <span class="hljs-operator">=</span> N<span class="hljs-string">&#x27;C:\Program Files\Microsoft SQL Server\MSSQL15.SQL1\MSSQL\Backup\AdventureWorks2019_FullBackup_20220607.bak&#x27;</span> <br><span class="hljs-keyword">WITH</span> NOFORMAT, NOINIT,  <br>NAME <span class="hljs-operator">=</span> N<span class="hljs-string">&#x27;AdventureWorks2019-Full Database Backup&#x27;</span>, <br><span class="hljs-keyword">SKIP</span>, NOREWIND, NOUNLOAD, COMPRESSION,  STATS <span class="hljs-operator">=</span> <span class="hljs-number">10</span>, CHECKSUM<br>GO<br><br><span class="hljs-comment">--Tlog Backups</span><br>BACKUP LOG [AdventureWorks2019] <span class="hljs-keyword">TO</span>  DISK <span class="hljs-operator">=</span> N<span class="hljs-string">&#x27;C:\Program Files\Microsoft SQL Server\MSSQL15.SQL1\MSSQL\Backup\Adventureworks2019_TlogBackup_20220607.trn&#x27;</span> <br><span class="hljs-keyword">WITH</span> NOFORMAT, NOINIT,  <br>NAME <span class="hljs-operator">=</span> N<span class="hljs-string">&#x27;AdventureWorks2019-Full Database Backup&#x27;</span>, <br><span class="hljs-keyword">SKIP</span>, NOREWIND, NOUNLOAD, COMPRESSION,  STATS <span class="hljs-operator">=</span> <span class="hljs-number">10</span>, CHECKSUM<br>GO<br></code></pre></td></tr></table></figure>
<figure>
<img
src="/2022/06/08/Install%20AlwaysOn%202019%20For%20Failover%20Clusters/image-20220607140009216.png"
alt="image-20220607140009216" />
<figcaption aria-hidden="true">image-20220607140009216</figcaption>
</figure>
<h2 id="install-always-on">Install Always On</h2>
<p>Connect to your primary replica, and start the <strong>New
Availability Group Wizard</strong>.</p>
<figure>
<img
src="/2022/06/08/Install%20AlwaysOn%202019%20For%20Failover%20Clusters/image-20220607142521671.png"
alt="image-20220607142521671" />
<figcaption aria-hidden="true">image-20220607142521671</figcaption>
</figure>
<figure>
<img
src="/2022/06/08/Install%20AlwaysOn%202019%20For%20Failover%20Clusters/image-20220607101944506.png"
alt="image-20220607101944506" />
<figcaption aria-hidden="true">image-20220607101944506</figcaption>
</figure>
<p>If the <code>status</code> of the database is not
<code>Meets prerequisites</code>, check detailed information.</p>
<figure>
<img
src="/2022/06/08/Install%20AlwaysOn%202019%20For%20Failover%20Clusters/image-20220607104426006.png"
alt="image-20220607104426006" />
<figcaption aria-hidden="true">image-20220607104426006</figcaption>
</figure>
<p>Add secondary replica.</p>
<figure>
<img
src="/2022/06/08/Install%20AlwaysOn%202019%20For%20Failover%20Clusters/image-20220607140235168.png"
alt="image-20220607140235168" />
<figcaption aria-hidden="true">image-20220607140235168</figcaption>
</figure>
<p>In the <code>Endpoints</code> tab, to avoid the following warning, we
need to set the <code>SQL Server Service Account</code> to the domain
account instead of the local server service account. Note that the
<code>Port Number</code> should be <strong>5022</strong></p>
<figure>
<img
src="/2022/06/08/Install%20AlwaysOn%202019%20For%20Failover%20Clusters/image-20220607141252469.png"
alt="image-20220607141252469" />
<figcaption aria-hidden="true">image-20220607141252469</figcaption>
</figure>
<p>In the <strong>SQL Service Configuration Manager</strong> of both
node servers, change the account name into the <strong>domain
account</strong> as the following.</p>
<figure>
<img
src="/2022/06/08/Install%20AlwaysOn%202019%20For%20Failover%20Clusters/image-20220607141542135.png"
alt="image-20220607141542135" />
<figcaption aria-hidden="true">image-20220607141542135</figcaption>
</figure>
<figure>
<img
src="/2022/06/08/Install%20AlwaysOn%202019%20For%20Failover%20Clusters/image-20220607141623518-16545825841621-16545825852083.png"
alt="image-20220607141623518" />
<figcaption aria-hidden="true">image-20220607141623518</figcaption>
</figure>
<p>Now, back to the wizard, refresh the page, and the account is
successfully changed.</p>
<figure>
<img
src="/2022/06/08/Install%20AlwaysOn%202019%20For%20Failover%20Clusters/image-20220607141929009.png"
alt="image-20220607141929009" />
<figcaption aria-hidden="true">image-20220607141929009</figcaption>
</figure>
<figure>
<img
src="/2022/06/08/Install%20AlwaysOn%202019%20For%20Failover%20Clusters/image-20220607142141848.png"
alt="image-20220607142141848" />
<figcaption aria-hidden="true">image-20220607142141848</figcaption>
</figure>
<p>Note that the <code>Port</code> should be <strong>1433</strong> and
the <code>IP Address</code> should be an unused IP Address on the
network.</p>
<figure>
<img
src="/2022/06/08/Install%20AlwaysOn%202019%20For%20Failover%20Clusters/image-20220607142110076.png"
alt="image-20220607142110076" />
<figcaption aria-hidden="true">image-20220607142110076</figcaption>
</figure>
<figure>
<img
src="/2022/06/08/Install%20AlwaysOn%202019%20For%20Failover%20Clusters/image-20220607142223919.png"
alt="image-20220607142223919" />
<figcaption aria-hidden="true">image-20220607142223919</figcaption>
</figure>
<figure>
<img
src="/2022/06/08/Install%20AlwaysOn%202019%20For%20Failover%20Clusters/image-20220607142235554-16545829607005.png"
alt="image-20220607142235554" />
<figcaption aria-hidden="true">image-20220607142235554</figcaption>
</figure>
<p>If successfully installed, we can find an AG listener in the
<strong>Failover Cluster Manager</strong>.</p>
<figure>
<img
src="/2022/06/08/Install%20AlwaysOn%202019%20For%20Failover%20Clusters/image-20220607143200288.png"
alt="image-20220607143200288" />
<figcaption aria-hidden="true">image-20220607143200288</figcaption>
</figure>
<h2 id="configure-read-only-route">Configure Read-Only Route</h2>
<h3 id="configuration">Configuration</h3>
<p>In the <strong>Object Explorer</strong>, open the
<strong>Properties</strong> of the AG. Change
<code>Readable Secondary</code> in <strong>Availability
Replicas</strong> to <code>Read-intent Only</code>.</p>
<figure>
<img
src="/2022/06/08/Install%20AlwaysOn%202019%20For%20Failover%20Clusters/image-20220607154139066.png"
alt="image-20220607154139066" />
<figcaption aria-hidden="true">image-20220607154139066</figcaption>
</figure>
<figure>
<img
src="/2022/06/08/Install%20AlwaysOn%202019%20For%20Failover%20Clusters/image-20220607161723678.png"
alt="image-20220607161723678" />
<figcaption aria-hidden="true">image-20220607161723678</figcaption>
</figure>
<p>For the two stand-alone SQL servers, in the <strong>SQL Server
Configuration Manager</strong>, <strong>Protocols for SQL 1 --&gt;
TCP/IP --&gt; Properties --&gt; IP Addresses --&gt; TPC Dynamic
Ports</strong>, change the port to an unused one for both services. This
step ensures we can find the servers using a Read-only routing URL with
the same port.</p>
<figure>
<img
src="/2022/06/08/Install%20AlwaysOn%202019%20For%20Failover%20Clusters/image-20220608093558782.png"
alt="image-20220608093558782" />
<figcaption aria-hidden="true">image-20220608093558782</figcaption>
</figure>
<p>Fill in the <code>Read-Only Routing URL</code> with
<code>TCP://ComputerName.domain:port</code>. The <code>port</code> here
should be the number set in the previous step. Then, click on the first
instance, there will be two available replicas shown, add SQL2 and then
add SQL1. Then, click on the second instance, there will also be two
available replicas shown, add SQL1 and then add SQL2.</p>
<figure>
<img
src="/2022/06/08/Install%20AlwaysOn%202019%20For%20Failover%20Clusters/image-20220608101300076.png"
alt="image-20220608101300076" />
<figcaption aria-hidden="true">image-20220608101300076</figcaption>
</figure>
<figure>
<img
src="/2022/06/08/Install%20AlwaysOn%202019%20For%20Failover%20Clusters/image-20220608101311244.png"
alt="image-20220608101311244" />
<figcaption aria-hidden="true">image-20220608101311244</figcaption>
</figure>
<p>Or, simply run the script.</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><code class="hljs sql">USE [master]<br> GO<br> <span class="hljs-keyword">ALTER</span> AVAILABILITY <span class="hljs-keyword">GROUP</span> [jiachengAG]<br> MODIFY REPLICA <span class="hljs-keyword">ON</span> N<span class="hljs-string">&#x27;TJXIEM405VM\SQL1&#x27;</span> <span class="hljs-keyword">WITH</span> (PRIMARY_ROLE(READ_ONLY_ROUTING_LIST <span class="hljs-operator">=</span> (N<span class="hljs-string">&#x27;TJXIEM406VM\SQL2&#x27;</span>,N<span class="hljs-string">&#x27;TJXIEM405VM\SQL1&#x27;</span>)))<br> GO<br> USE [master]<br> GO<br> <span class="hljs-keyword">ALTER</span> AVAILABILITY <span class="hljs-keyword">GROUP</span> [jiachengAG]<br> MODIFY REPLICA <span class="hljs-keyword">ON</span> N<span class="hljs-string">&#x27;TJXIEM406VM\SQL2&#x27;</span> <span class="hljs-keyword">WITH</span> (PRIMARY_ROLE(READ_ONLY_ROUTING_LIST <span class="hljs-operator">=</span> (N<span class="hljs-string">&#x27;TJXIEM405VM\SQL1&#x27;</span>,N<span class="hljs-string">&#x27;TJXIEM406VM\SQL2&#x27;</span>)))<br> GO<br></code></pre></td></tr></table></figure>
<h3 id="test">Test</h3>
<p>Connect the AG listener. Click <strong>Options</strong> to configure
the connection.</p>
<figure>
<img
src="/2022/06/08/Install%20AlwaysOn%202019%20For%20Failover%20Clusters/image-20220608093733764.png"
alt="image-20220608093733764" />
<figcaption aria-hidden="true">image-20220608093733764</figcaption>
</figure>
<p>Note that the connected database needs to be specified in
<code>Connection Properties</code></p>
<figure>
<img
src="/2022/06/08/Install%20AlwaysOn%202019%20For%20Failover%20Clusters/image-20220608093829901.png"
alt="image-20220608093829901" />
<figcaption aria-hidden="true">image-20220608093829901</figcaption>
</figure>
<p>Also, add <code>ApplicationIntent=ReadOnly</code> as connection
strings to enable Read-only routing.</p>
<figure>
<img
src="/2022/06/08/Install%20AlwaysOn%202019%20For%20Failover%20Clusters/image-20220608093924655.png"
alt="image-20220608093924655" />
<figcaption aria-hidden="true">image-20220608093924655</figcaption>
</figure>
<p>New a query, run the script, the Read-only routing works as I am
working in the primary replica while it routes read-only connections to
the secondary replica.</p>
<figure>
<img
src="/2022/06/08/Install%20AlwaysOn%202019%20For%20Failover%20Clusters/image-20220608094019762.png"
alt="image-20220608094019762" />
<figcaption aria-hidden="true">image-20220608094019762</figcaption>
</figure>
]]></content>
      <tags>
        <tag>SQL Server</tag>
      </tags>
  </entry>
  <entry>
    <title>SQL Server Backup</title>
    <url>/2022/06/06/SQL%20Server%20Backup/</url>
    <content><![CDATA[<h1 id="sql-server-backup">SQL Server Backup</h1>
<p><strong>Full Backup</strong></p>
<figure class="highlight sql"><table><tr><td class="code"><pre><code class="hljs sql">backup database AdventureWorks2019 <span class="hljs-keyword">to</span> disk <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;C:\Windows\AdventureWorks2019_20220602.bak&#x27;</span>;<br></code></pre></td></tr></table></figure>
<p>If get an error like this:</p>
<figure>
<img src="/2022/06/06/SQL%20Server%20Backup/image-20220606100125253.png"
alt="image-20220606100125253" />
<figcaption aria-hidden="true">image-20220606100125253</figcaption>
</figure>
<p>It means that the SQL server has no permission to the location. To
fix this, in the <strong>SQL Server Configuration Manager</strong>, we
can find that the SQL service is logged on as
<code>NT Service\MSSQLSERVER</code>.</p>
<figure>
<img src="/2022/06/06/SQL%20Server%20Backup/image-20220606100346465.png"
alt="image-20220606100346465" />
<figcaption aria-hidden="true">image-20220606100346465</figcaption>
</figure>
<p>Then right-click on the folder you want to access, <strong>properties
--&gt; security</strong>, and add permission to the
<code>NT Service\MSSQLSERVER</code>.</p>
<figure>
<img src="/2022/06/06/SQL%20Server%20Backup/image-20220606100858530.png"
alt="image-20220606100858530" />
<figcaption aria-hidden="true">image-20220606100858530</figcaption>
</figure>
<p><strong>Backup with differential</strong></p>
<p>This will back up the changed pages from the previous full
backup.</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><code class="hljs sql"><span class="hljs-comment">-- backup changes start from last full backup, save changed page only</span><br>backup database AdventureWorks2019 <span class="hljs-keyword">to</span> disk <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;C:\Users\t-jxie\Downloads\AdventureWorks2019_20220602_2.bak&#x27;</span> <span class="hljs-keyword">with</span> differential;<br></code></pre></td></tr></table></figure>
<p><strong>Backup with copy_only</strong></p>
<p>This will leave the DCM (diff change map) unchanged, meaning that if
we are back up with differential, it will also backup changes from the
last full backup.</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><code class="hljs sql"><span class="hljs-comment">-- backup, leave (DCM) diff change map unchanged, compressed</span><br>backup database AdventureWorks2019 <span class="hljs-keyword">to</span> disk <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;C:\Users\t-jxie\Downloads\AdventureWorks2019_20220602_2.bak&#x27;</span> <span class="hljs-keyword">with</span> copy_only, compression;<br></code></pre></td></tr></table></figure>
<p>The DCM records the changes made to the page of the database, we can
view the DCM of the specific database by</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><code class="hljs sql">dbcc page(<span class="hljs-number">5</span>, <span class="hljs-number">1</span>, <span class="hljs-number">6</span>, <span class="hljs-number">2</span>)<br></code></pre></td></tr></table></figure>
<figure>
<img src="/2022/06/06/SQL%20Server%20Backup/image-20220606101710464.png"
alt="image-20220606101710464" />
<figcaption aria-hidden="true">image-20220606101710464</figcaption>
</figure>
<p><strong>Backup log files</strong></p>
<figure class="highlight sql"><table><tr><td class="code"><pre><code class="hljs sql">backup log AdventureWorks2019 <span class="hljs-keyword">to</span> disk <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;C:\Users\t-jxie\Downloads\AdventureWorks2019_20220602.trn&#x27;</span>;<br></code></pre></td></tr></table></figure>
<p>We can view the information of log files of databases by</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><code class="hljs sql">dbcc sqlperf(logspace)<br></code></pre></td></tr></table></figure>
<figure>
<img src="/2022/06/06/SQL%20Server%20Backup/image-20220606101859208.png"
alt="image-20220606101859208" />
<figcaption aria-hidden="true">image-20220606101859208</figcaption>
</figure>
]]></content>
      <tags>
        <tag>SQL Server</tag>
        <tag>T-SQL</tag>
      </tags>
  </entry>
</search>
